<!DOCTYPE HTML >
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>邀请卡</title>
    <style>
        body{margin: 0}
        .title{
            background: #A4F1F1;
            height: 5rem;
            font-family: PingFangSC-Regular;
            font-size: 2rem;
            color: #00A5A5;
            text-align: center;
            line-height: 5rem;
        }
        .pic{
            width: 85%;
            height: auto;
            margin: 40px auto;
        }
        .pic img{
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <div class="title">
        长按下方图片，保存图片 或 发送给朋友
    </div>
    <div class='pic'>
        <canvas id="myCanvas" style="display: none"></canvas>
        <img src="" id="img" style="width: 100%;">
    </div>

    <img crossorigin="anonymous" src="" id="avatar" style="display:none ">
    <!--<img  src="" id="ewm" style="display: none">-->


    <script>
        var nickname = localStorage.getItem('nickname')
        var txt = '我发现一个很棒的测评，你也来试试吧！'
        // localStorage.setItem('avtor','https://wx.qlogo.cn/mmopen/vi_32/ahxELat57Wicnl4EfEzvVViakdV5RoW8eLozTId4a40LdOXFv5pYq40icJ8w2KEXx0Bob0v7kHatcl5OR8eEiapv8w/132')
        // localStorage.setItem('ewm','https://dis.ucharmedu.com/img/wxcode.jpg')
        document.getElementById("avatar").src = localStorage.getItem('avator')
        console.log(localStorage.getItem('openid'))
        // document.getElementById("ewm").src = localStorage.getItem('ewm')
        var ewm = localStorage.getItem('ewm')

        canvasImg()
        function canvasImg() {

            var bgimg = new Image();
            // bgimg.crossOrigin = "Anonymous";
            bgimg.src="https://dis.ucharmedu.com/image/bg.png";

            bgimg.onload = function () {

                var canvas = document.getElementById('myCanvas');
                var ctx=canvas.getContext('2d')
                canvas.width = 600;
                canvas.height = 1064;

                ctx.drawImage(bgimg, 0, 0, 600, 1064);   //里面的参数无非就是图片放置的位置即图片的横纵坐标，图片的宽高

                ctx.font = "28px PingFangSC-Light";
                ctx.fillStyle = "#fff";
                ctx.fillText(nickname, 150, 104);            //150:canvas画布宽300，取1/2，中间，280：纵向位置
                ctx.font = "24px PingFangSC-Light";
                ctx.fillText(txt, 150, 150);

                var avatarimg=document.getElementById("avatar");
                // var ewmimg=document.getElementById("ewm");
                // var aimg = new Image();
                // aimg.setAttribute('crossorigin', 'anonymous');
                // aimg.src = localStorage.getItem('avatar')

                var ewmimg = new Image();
                ewmimg.setAttribute('crossorigin', 'anonymous');
                ewmimg.src= localStorage.getItem('ewm');
                ewmimg.onload=function () {
                    ctx.drawImage(ewmimg, 413, 850, 133, 135);

                    // var aimg = new Image();
                    // aimg.setAttribute('crossorigin', 'anonymous');
                    // aimg.src = 'https://wx.qlogo.cn/mmopen/vi_32/ahxELat57Wicnl4EfEzvVViakdV5RoW8eLozTId4a40LdOXFv5pYq40icJ8w2KEXx0Bob0v7kHatcl5OR8eEiapv8w/132'
                    // aimg.onload = function () {
                    //     circleImg(ctx, avatarimg, 50, 50, 40);


                        canvas.style.width = '100%' //css控制大小
                        var pics = canvas.toDataURL('image/png')
                        document.getElementById("img").src = pics
                    // }


                }



            }


        }

        function circleImg (ctx, img, x, y, r) {
            ctx.save();
            var d = 2 * r;
            var cx = x + r;
            var cy = y + r;
            ctx.beginPath();
            ctx.arc(cx, cy, r, 0, 2 * Math.PI);
            ctx.clip();
            ctx.drawImage(img, x, y, d, d);
        }
    </script>

</body>
</html>